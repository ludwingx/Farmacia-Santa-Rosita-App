<div class="container">
    <div class="row">
        <div class="col-12">
            <h4 class="titleProduct">Listado de productos</h4>
        </div>
    </div>
    <!-- <table class="table table-bordered border border-dark-subtle">
        <thead class="table-green" >
          <tr>
            <th>ID</th>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio de compra</th>
            <th>Precio de venta</th>
            <th>Stock Actual</th>
            <th>Proovedor</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
            @for (product of products; track product.id) {
                <tr >
                    <td>{{ formatProductId(product.id) }}</td>
                    <td><img class="imgProduct" src="{{ product.image }}" alt="product.name"></td>
                    <td>{{ product.name }}</td><td>{{ product.description }}</td>
                    <td>{{ product.purchase_price | currency : 'Bs.' }}</td> 
                    <td>{{ product.selling_price | currency : 'Bs.' }}</td> 
                    <td>{{ product.current_stock}}</td>
                    <td>{{ product.supplier.name }}</td>
                    <td>
                        <div class="dropdown">
                            <button class="btn dropdown-toggle"  type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              Configuraciones
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" (click)="editProduct(product)">
                                        Editar 
                                        <i class="fa-solid fa-pen"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" (click)="openDeleteConfirmationModal(product)">
                                        Eliminar 
                                        <i class="fa-solid fa-trash"></i>
                                    </a>   
                                </li>
                            </ul>
                          </div>
                    </td>
                  </tr>
            }
        </tbody>
    </table> -->
   @for (product of products; track product.id) {
    <div class="accordion accordion-flush" id="accordionFlushExample">
      <div class="accordion-item">
        <div class="accordion-header row">
          <div class="col">
            <h4>   {{ formatProductId(product.id) }} <img src="{{ product.image }}" class="imgProduct" alt="">{{ product.name }} {{product.selling_price | currency : 'Bs.' }}<span>U: </span> <span class="fw-bold text-end">({{ calculateTotalQuantity(product.lots!) }})</span></h4>
          </div>
          <div class="col-4 d-grid gap-2 d-md-flex justify-content-md-end">
            <div class="row">
                <div class="col">
                    <!-- Botón de editar -->
                    <button class="btn btn-primary btn-sm">Editar</button>
                </div>
                <div class="col">
                    <!-- Botón de eliminar -->
                    <button class="btn btn-danger btn-sm">Eliminar</button>
                </div>
                <div class="col">
                    <!-- Botón del acordeón -->
                    <button class="accordion-button collapsed" type="button" [attr.data-bs-toggle]="'collapse'" [attr.data-bs-target]="'#flush-collapse-' + product.id" aria-expanded="false" [attr.aria-controls]="'flush-collapse' + '{{ product.id }}'">
                    </button>
                </div>
            </div>
        </div>
        </div>

        <div id="flush-collapse-{{ product.id }}" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
          <div class="accordion-body">
            @if (product.lots && product.lots.length > 0) {
              <p>Lotes:</p>
              <ul >
                @for (lot of product.lots; track lot.id) {
                  <li>
                    <a href="">
                      Lote: {{ lot.id }} - Cantidad: {{ lot.quantity }}/{{lot.initial_quantity}} - Fecha de vencimiento: {{ lot.expiration_date }}
                      <!-- Botón de editar lote -->
                      <button class="btn btn-primary btn-sm" >Editar</button>
                      <!-- Botón de eliminar lote -->
                      <button class="btn btn-danger btn-sm" >Eliminar</button>
                    </a>
                  </li>
                }
            </ul>
            } 
            @else {
              <!-- Botón para agregar lotes cuando no hay lotes disponibles -->
              <p class="text-danger">No hay lotes disponibles!</p>
              <button class="btn btn-success" >Agregar Lote</button>
            }
        </div>

        </div>

      </div>

    </div>
    <hr>
   }
</div>

<br>
<br>

<!-- Modal de confirmación -->
<div class="modal" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Eliminar Producto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro de que deseas eliminar  "{{ productToDelete?.name }}"?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary " data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Eliminar</button>
      </div>
    </div>
  </div>
</div>